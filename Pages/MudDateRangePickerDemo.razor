@page "/components/daterangepicker"
@using MudBlazor

<MudGrid Gutter="Size.Medium">

    <!-- LEFT: examples -->
    <MudItem xs="12" md="8">
        <MudText Typo="Typo.subtitle1" Class="mb-2">Examples</MudText>
        <MudStack Spacing="3">

            <!-- Editable + actions (also respects global toggles) -->
            <MudDateRangePicker
                @ref="_picker"
                @bind-DateRange="_rangeExtra"
                Variant="Variant.Text"
                Label="Editable Range with Action Buttons"
                Margin="@ComputedMargin"
                PickerIcon="@Icons.Material.Filled.DateRange"
                Disabled="@_disabled"
                ReadOnly="@(_readonly || !_editable)"
                Clearable="@_clearable"
                AutoClose="@_autoClose"
                ShrinkLabel="@_shrinkLabel"
                PlaceholderStart="@(_placeholder ? "Start date" : null)"
                PlaceholderEnd="@(_placeholder ? "End date" : null)"
                HelperText="@(_helperText ? "Helper Text" : null)"
                HelperTextOnFocus="@_helperTextOnFocus"
                Error="@_hasError"
                ErrorText="Please select a range">
                <PickerActions>
                    <MudButton Class="mr-auto align-self-start" OnClick="@(() => _picker.ClearAsync())">Clear</MudButton>
                    <MudButton OnClick="@(() => _picker.CloseAsync(false))">Cancel</MudButton>
                    <MudButton Color="Color.Primary" OnClick="@(() => _picker.CloseAsync())">OK</MudButton>
                </PickerActions>
            </MudDateRangePicker>

            <!-- Editable + actions (also respects global toggles) -->
            <MudDateRangePicker
                @ref="_picker"
                @bind-DateRange="_rangeExtra"
                Variant="Variant.Filled"
                Label="Editable Range with Action Buttons"
                Margin="@ComputedMargin"
                PickerIcon="@Icons.Material.Filled.DateRange"
                Disabled="@_disabled"
                ReadOnly="@(_readonly || !_editable)"
                Clearable="@_clearable"
                AutoClose="@_autoClose"
                ShrinkLabel="@_shrinkLabel"
                PlaceholderStart="@(_placeholder ? "Start date" : null)"
                PlaceholderEnd="@(_placeholder ? "End date" : null)"
                HelperText="@(_helperText ? "Helper Text" : null)"
                HelperTextOnFocus="@_helperTextOnFocus"
                Error="@_hasError"
                ErrorText="Please select a range">
                <PickerActions>
                    <MudButton Class="mr-auto align-self-start" OnClick="@(() => _picker.ClearAsync())">Clear</MudButton>
                    <MudButton OnClick="@(() => _picker.CloseAsync(false))">Cancel</MudButton>
                    <MudButton Color="Color.Primary" OnClick="@(() => _picker.CloseAsync())">OK</MudButton>
                </PickerActions>
            </MudDateRangePicker>

            <!-- Custom formats -->
            <MudDateRangePicker
                @bind-DateRange="_rangeFormatted"
                Variant="Variant.Filled"
                Label="Custom Date Format Range"
                Margin="@ComputedMargin"
                PickerIcon="@Icons.Material.Filled.Today"
                DateFormat="dddd, dd MMMM, yyyy"
                TitleDateFormat="MMMM dd"
                Disabled="@_disabled"
                ReadOnly="@(_readonly || !_editable)"
                Clearable="@_clearable"
                AutoClose="@_autoClose"
                ShrinkLabel="@_shrinkLabel"
                PlaceholderStart="@(_placeholder ? "Start date" : null)"
                PlaceholderEnd="@(_placeholder ? "End date" : null)"
                HelperText="@(_helperText ? "Helper Text" : null)"
                HelperTextOnFocus="@_helperTextOnFocus"
                Error="@_hasError"
                ErrorText="Please select a range" />

            <!-- Min/Max date -->
            <MudDateRangePicker
                @bind-DateRange="_rangeLimitedDates"
                Variant="Variant.Outlined"
                Label="Min/Max Date Range"
                Margin="@ComputedMargin"
                PickerIcon="@Icons.Material.Filled.EventAvailable"
                MinDate="_minDate"
                MaxDate="@_maxDate"
                Disabled="@_disabled"
                ReadOnly="@(_readonly || !_editable)"
                Clearable="@_clearable"
                AutoClose="@_autoClose"
                ShrinkLabel="@_shrinkLabel"
                PlaceholderStart="@(_placeholder ? "Start date" : null)"
                PlaceholderEnd="@(_placeholder ? "End date" : null)"
                HelperText="@(_helperText ? HelperText : null)"
                HelperTextOnFocus="@_helperTextOnFocus"
                Error="@_hasError"
                ErrorText="Please select a range" />

            <!-- Min/Max days -->
            <MudDateRangePicker
                @bind-DateRange="_rangeLimitedDays"
                Variant="Variant.Outlined"
                Label="Min/Max Days Range"
                Margin="@ComputedMargin"
                PickerIcon="@Icons.Material.Filled.EventNote"
                MinDays="_minDays"
                MaxDays="@_maxDays"
                Disabled="@_disabled"
                ReadOnly="@(_readonly || !_editable)"
                Clearable="@_clearable"
                AutoClose="@_autoClose"
                ShrinkLabel="@_shrinkLabel"
                PlaceholderStart="@(_placeholder ? "Start date" : null)"
                PlaceholderEnd="@(_placeholder ? "End date" : null)"
                HelperText="@(_helperText ? HelperText2 : null)"
                HelperTextOnFocus="@_helperTextOnFocus"
                Error="@_hasError"
                ErrorText="Please select a range" />
        </MudStack>
    </MudItem>

    <!-- RIGHT: wrapped controls -->
    <MudItem xs="12" md="4">
        <MudText Typo="Typo.subtitle1" Class="mb-2">Controls</MudText>

        <MudPaper Class="pa-3">
            <MudStack Row="true" Spacing="2" AlignItems="AlignItems.Center" Class="controls-stack">
                <MudSwitch Class="control-item" @bind-Value="_dense" Label="Dense" Color="Color.Primary" />
                <MudSwitch Class="control-item" @bind-Value="_readonly" Label="ReadOnly" Color="Color.Primary" />
                <MudSwitch Class="control-item" @bind-Value="_disabled" Label="Disabled" Color="Color.Primary" />
                <MudSwitch Class="control-item" @bind-Value="_placeholder" Label="Placeholder" Color="Color.Primary" />
                <MudSwitch Class="control-item" @bind-Value="_helperText" Label="HelperText" Color="Color.Primary" />
                <MudSwitch Class="control-item" @bind-Value="_helperTextOnFocus" Label="HelperTextOnFocus" Color="Color.Primary" />
                <MudSwitch Class="control-item" @bind-Value="_clearable" Label="Clearable" Color="Color.Primary" />
                <MudSwitch Class="control-item" @bind-Value="_hasError" Label="Show Error" Color="Color.Error" />
                <MudSwitch Class="control-item" @bind-Value="_shrinkLabel" Label="ShrinkLabel" Color="Color.Primary" />
                <MudSwitch Class="control-item" @bind-Value="_editable" Label="Editable" Color="Color.Secondary" />
                <MudSwitch Class="control-item" @bind-Value="_autoClose" Label="AutoClose" Color="Color.Secondary" />
            </MudStack>

            <MudSelect T="Margin" @bind-Value="_margin" Label="Margin" Dense="true" Class="mt-3" Style="max-width:220px;">
                <MudSelectItem Value="Margin.None">None</MudSelectItem>
                <MudSelectItem Value="Margin.Dense">Dense</MudSelectItem>
                <MudSelectItem Value="Margin.Normal">Normal</MudSelectItem>
            </MudSelect>
        </MudPaper>
    </MudItem>
</MudGrid>

<!-- ===== Picker panel (bottom) ===== -->
<MudDivider Class="my-6" />
<MudText Typo="Typo.h6">Picker panel</MudText>

<MudGrid Gutter="Size.Medium" Class="mt-2">

    <MudItem md="8" Class="d-flex justify-center">
        <MudDateRangePicker
    @ref="_panelPicker"
    PickerVariant="@PanelVariant"
    @bind-DateRange="_panelRange"
    AutoClose="@PanelAutoClose"
    OpenTo="@PanelOpenTo"
    Orientation="@PanelOrientation"
    Margin="Margin.Dense"
    Variant="Variant.Outlined"
    Class="pa-2"
    PickerIcon="@Icons.Material.Filled.DateRange">

    <PickerActions>
        @if (PanelShowActions)
        {
            <MudButton Class="mr-auto align-self-start"
                       OnClick="async () => await _panelPicker.ClearAsync()">
                Clear
            </MudButton>
            <MudButton OnClick="async () => await _panelPicker.CloseAsync(false)">
                Cancel
            </MudButton>
            <MudButton Color="Color.Primary"
                       OnClick="async () => await _panelPicker.CloseAsync()">
                OK
            </MudButton>
        }
    </PickerActions>
</MudDateRangePicker>

    </MudItem>

    <MudItem md="4">
        <MudPaper Height="500px" Class="px-4 pt-2 pb-4">
            <MudText Typo="Typo.h6">Options</MudText>

            <!-- Variant selector (Inline / Dialog / Static) -->
            <MudToggleGroup T="PickerVariant"
                            Value="@PanelVariant"
                            ValueChanged="@(v => PanelVariant = v)"
                            SelectionMode="SelectionMode.SingleSelection"
                            Color="Color.Primary"
                            CheckMark="true"
                            FixedContent="true"
                            Class="mb-3">
                <MudToggleItem Value="PickerVariant.Inline"  Text="INLINE"  />
                <MudToggleItem Value="PickerVariant.Dialog"  Text="DIALOG"  />
                <MudToggleItem Value="PickerVariant.Static"  Text="STATIC"  />
            </MudToggleGroup>

            <MudCheckBox @bind-Value="PanelShowActions"
                         Label="Show actions (Clear / Cancel / OK)"
                         Color="Color.Primary"
                         Dense="true" />

            <MudCheckBox @bind-Value="PanelAutoClose"
                         Label="Auto Close"
                         Color="Color.Primary"
                         Dense="true" />

            <MudSelect T="OpenTo" @bind-Value="PanelOpenTo" Label="Open To"
                       Variant="Variant.Outlined" Dense="true" Margin="Margin.Dense" Class="mt-3">
                <MudSelectItem Value="OpenTo.Date">Date</MudSelectItem>
                <MudSelectItem Value="OpenTo.Month">Month</MudSelectItem>
                <MudSelectItem Value="OpenTo.Year">Year</MudSelectItem>
            </MudSelect>

            <MudSelect T="Orientation" @bind-Value="PanelOrientation" Label="Orientation"
                       Variant="Variant.Outlined" Dense="true" Margin="Margin.Dense" Class="mt-3">
                <MudSelectItem Value="Orientation.Portrait">Portrait</MudSelectItem>
                <MudSelectItem Value="Orientation.Landscape">Landscape</MudSelectItem>
            </MudSelect>

            <MudText Class="mt-3" Typo="Typo.caption">
                Selected: @( _panelRange is null ? "—" : $"{_panelRange.Start:yyyy-MM-dd} → {_panelRange.End:yyyy-MM-dd}" )
            </MudText>
        </MudPaper>
    </MudItem>
</MudGrid>

<style>
  /* Wrap the switches nicely */
  .controls-stack { display:flex; flex-wrap: wrap; }
  .controls-stack .control-item { min-width: 160px; }
</style>

@code {
    // example ranges (left column)
    private DateRange? _rangeExtra = new(DateTime.Today, DateTime.Today.AddDays(5));
    private DateRange? _rangeFormatted;
    private DateRange? _rangeLimitedDates;
    private DateRange? _rangeLimitedDays;

    private MudDateRangePicker _picker = default!;

    // controls (right column)
    private bool _dense, _disabled, _readonly, _placeholder, _helperText, _helperTextOnFocus, _clearable = true, _hasError, _shrinkLabel;
    private bool _editable = true, _autoClose = false;

    private Margin _margin = Margin.None;
    private Margin ComputedMargin => _dense ? Margin.Dense : _margin;

    // limits for examples
    private DateTime _minDate = DateTime.Today;
    private DateTime _maxDate = DateTime.Today.AddMonths(1);
    private string HelperText => $"Range: {_minDate:M} to {_maxDate:M}";
    private int _minDays = 3;
    private int _maxDays = 7;
    private string HelperText2 => $"Range: {_minDays} to {_maxDays} days";

    // bottom panel state
    private MudDateRangePicker _panelPicker = default!;
    private DateRange? _panelRange = new(DateTime.Today, DateTime.Today.AddDays(3));

    public PickerVariant PanelVariant { get; set; } = PickerVariant.Static;
    public bool PanelShowActions { get; set; } = false;   // toggle the bottom actions bar
    public bool PanelAutoClose   { get; set; } = true;
    public OpenTo PanelOpenTo    { get; set; } = OpenTo.Date;
    public Orientation PanelOrientation { get; set; } = Orientation.Portrait;

}
